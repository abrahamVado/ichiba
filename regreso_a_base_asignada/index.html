<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Regreso a base – Banner</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800;900&display=swap" rel="stylesheet">
<link href="../styles/main.css" rel="stylesheet">
</head>
<body class="page-regreso-base">
<div id="map"></div>
<div class="top">
  <div class="banner">
    <div class="title">Regreso a base asignada</div>
    <div class="sub">Siga la ruta indicada para regresar a su base de operaciones. No podrá recibir nuevos viajes hasta confirmar su llegada.</div>
  </div>
</div>
<div id="pill" class="pill">8&nbsp;min</div>

<script>
//1.- Seleccionar los elementos visibles que actúan como llamada a la acción.
const banner = document.querySelector('.banner');
const pill = document.getElementById('pill');
//2.- Permitir avanzar al resumen al interactuar con el banner principal.
if (banner) {
  banner.addEventListener('click', () => {
    window.location.href = '../resumen_de_jornada/';
  });
}
//3.- Ofrecer la misma navegación mediante la píldora de tiempo.
if (pill) {
  pill.addEventListener('click', () => {
    window.location.href = '../resumen_de_jornada/';
  });
}
</script>

<script>
//1.- Preparar referencias para el mapa y la ruta a mostrar.
let map, route;

//2.- Inicializar el mapa con estilos personalizados.
function initMap(){
  const start={lat:18.001,lng:-94.574}, end={lat:18.017,lng:-94.537};
  map=new google.maps.Map(document.getElementById('map'),{
    center:{lat:18.008,lng:-94.556},zoom:13,disableDefaultUI:true,
    styles:[
      {elementType:"geometry",stylers:[{color:"#0f1115"}]},
      {elementType:"labels.text.fill",stylers:[{color:"#616161"}]},
      {featureType:"road",elementType:"geometry",stylers:[{color:"#1c2026"}]},
      {featureType:"water",stylers:[{color:"#0c1117"}]},
      {featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"off"}]}
    ]
  });

  //3.- Pintar la ruta sugerida para el regreso a base.
  const path=[start,{lat:18.006,lng:-94.564},{lat:18.012,lng:-94.551},end];
  route=new google.maps.Polyline({path,strokeColor:"#d4a016",strokeOpacity:1,strokeWeight:6,map});

  //4.- Posicionar la píldora informativa cerca de la última curva.
  const pillPos=path[2];
  function placePill(){
    const bounds=map.getBounds();
    if(!bounds) return;
    const projection=map.getProjection();
    if(!projection) return;
    const nw=projection.fromLatLngToPoint(bounds.getNorthEast());
    const se=projection.fromLatLngToPoint(bounds.getSouthWest());
    const worldPoint=projection.fromLatLngToPoint(new google.maps.LatLng(pillPos));
    const x=(worldPoint.x-se.x)/(nw.x-se.x)*window.innerWidth;
    const y=(worldPoint.y-nw.y)/(se.y-nw.y)*window.innerHeight;
    const el=document.getElementById('pill');
    el.style.left=x+"px";
    el.style.top=y+"px";
  }

  //5.- Actualizar la posición de la píldora según los cambios en el mapa.
  google.maps.event.addListenerOnce(map,'idle',placePill);
  map.addListener('bounds_changed',placePill);
}
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&v=weekly&callback=initMap"></script>
</body>
</html>
